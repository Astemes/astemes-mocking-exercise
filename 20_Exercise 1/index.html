
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Anton Sundqvist" name="author"/>
<link href="http://astemes.com/20_Exercise%201/" rel="canonical"/>
<link href="../Style/logo.png" rel="icon"/>
<meta content="mkdocs-1.2.3, mkdocs-material-7.3.4" name="generator"/>
<title>Exercise 1 - Astemes Mocking Exercise</title>
<link href="../assets/stylesheets/main.db9e7362.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.3f5d1f46.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
<link href="../Style/style.css" rel="stylesheet"/>
</head>
<body data-md-color-accent="none" data-md-color-primary="none" data-md-color-scheme="" dir="ltr">
<script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#exercise-1">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Astemes Mocking Exercise" class="md-header__button md-logo" data-md-component="logo" href=".." title="Astemes Mocking Exercise">
<img alt="logo" src="../Style/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Astemes Mocking Exercise
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Exercise 1
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/astemes/astemes-mocking-exercise/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Astemes Mocking Exercise" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Astemes Mocking Exercise">
<img alt="logo" src="../Style/logo.png"/>
</a>
    Astemes Mocking Exercise
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/astemes/astemes-mocking-exercise/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../10_Introduction/Introduction/">
        Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../15_Prerequisites/Prerequisites/">
        Prerequisites
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Exercise 1
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Exercise 1
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#first-test">
    First test
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#refactoring">
    Refactoring
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#addressing-the-addressing-issue">
    Addressing the Addressing Issue
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#controlling-the-outputs">
    Controlling the Outputs
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adding-more-tests">
    Adding more Tests
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#setting-multiple-bits">
    Setting Multiple Bits
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#final-thoughts">
    Final thoughts
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../90_License/LICENSE/">
        License
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#first-test">
    First test
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#refactoring">
    Refactoring
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#addressing-the-addressing-issue">
    Addressing the Addressing Issue
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#controlling-the-outputs">
    Controlling the Outputs
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adding-more-tests">
    Adding more Tests
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#setting-multiple-bits">
    Setting Multiple Bits
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#final-thoughts">
    Final thoughts
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/astemes/astemes-mocking-exercise/edit/master/docs/20_Exercise 1/index.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="exercise-1">Exercise 1</h1>
<p>During this first exercise we will implement the digital output functionality of the I/O Expander.
Make sure that you have cloned the repository and checked out the branch called <code>exercise-starting-point</code>.
This should give you a folder called <em>source</em> containing a LabVIEW project file, some boilerplate code and the datasheet for the MCP23017 which we will be using.</p>
<p><img alt="LabVIEW project" src="img/starting-project.png"/></p>
<p>Open the LabVIEW project, which contains an abstraction for the I2C bus and the data sheet for the MCP23017.
Have quick skim through the data sheet to get familiar with the device. 
Don’t spend too much time on it, but familiarize yourself with how the device is addressed and the registers IODIRA, IODIRB, GPIOA, and GPIOB. 
We are not going to use any other registers. </p>
<p>If you have never worked with an I2C bus before, just ignore the details and assume it is a bus which you may either write to or read from by giving an address. The data type of both operations is a byte array. </p>
<h2 id="first-test">First test</h2>
<p>We will now begin to implement the digital output functionality on port A of the MCP23017.
So in the spirit of Test Driven Development, we will begin by creating a test.
To do this, click on the New LUnit Test Case button in the toolbar and name it <code>MCP23017 Test.lvclass</code>.</p>
<p><img alt="LabVIEW project" src="img/new-lunit-test-case.png"/></p>
<p>We will keep the <em>tests</em> directory on the same level as the <em>source</em> directory and the test case should be saved within the directory.</p>
<p><img alt="Directory Structure" src="img/folder-structure.png"/></p>
<p>Now, create a new test method by right clicking the <code>Test Method Template.vit</code> in the project and select <code>New from Template</code>.
Save the VI and run it.
At this point the name does not matter as long as it begins with the four letters <code>test</code>. 
You should see it failing (obviously), but this is a good check to see that you have the tools setup and working.</p>
<p>You can also run all tests in the project from the toolbar button.</p>
<p>Next, let's consider what we should be testing.
Reading into the datasheet we can see that the IODIR registers IODIRA and IODIRB needs to be configured to make the pins working as outputs.
The register is a 8-bit, single byte, register and we will need to write a <code>0x00</code> to the register.</p>
<p><img alt="IODIR" src="img/IODIR-registers.png"/></p>
<p>Now, how can we test this?
We can see that IODIRA is located at register address <code>0x00</code> and we will for now assume that the device uses I2C address of <code>0</code> (we'll get back to revisit this later).
So we need to verify that when initializing our driver for the MCP23017, the two bytes [<code>0x00</code>, <code>0x00</code>] are written to device address <code>0</code>.
The first of these bytes represents the register address we want to write to and the second byte is the actual data.</p>
<p>To achieve this, let us begin by creating a mock of the I2C bus.
Do this by right clicking the I2C Bus interface in the LabVIEW project and select <code>Mock...</code>.</p>
<p><img alt="Mock I2C Bus" src="img/mock-i2c.png"/></p>
<p>Save the test double within the tests folder using the suggested name. 
Now, we will begin to implement the test we created by using the mock class.
You will find the <code>Create.vi</code> and <code>Write.vi</code> in the generated mock class, and the <code>One.vi</code> and <code>Verify.vi</code> are both part of the LMock API and found on the pallette or using quick drop.</p>
<p><img alt="First test attempt 1" src="img/Test1-1.png"/></p>
<p>Run this test to see that the mocking framework works as expected.
You should se a failing text with a description as below.</p>
<p><img alt="First test failing" src="img/Test1-1-failing.png"/></p>
<p>View the description reported by the mock verification and make sure you understand how this test works.
If it is unclear, please refer to the <a href="https://lmock.astemes.com/">LMock Documentation</a>.
The test can, of course, not pass yet as we have nothing acting on the I2C Bus, so the declared expectation cannot be fulfilled.</p>
<p>After some work we have finally arrived at a failing test that actually tests something useful.
Except we are not calling any of our code - we have not even written any code yet!
So lets fix that. </p>
<p>Add a class the the project and call it <code>MCP23017.lvclass</code>.
Create a constructor for the class taking the <code>I2C Bus.lvclass</code> interface as an input and wire this into the test as shown below.
The constructor (Create.vi in image below) is a useful pattern to guarantee that the state of the object is valid, and it also makes finding callers of the class simple in the LabVIEW IDE.
While at it, maybe rename the test to something more meaningful, such as <code>Test IODIR Configured as Output on Create.vi</code></p>
<p><img alt="First test attempt 1" src="img/Test1-1-final.png"/></p>
<p>And at last we are allowed to write some actual code.
This should be trivial, so go on and make the test pass.</p>
<h2 id="refactoring">Refactoring</h2>
<p>Since we have passing test, next let's clean up what we made some. 
Refactoring is the process of making structural changes to the code without changing the behavior.
There is not a lot of code to work with, but there should be a few things we can improve.
Feel free to work the code until it is readable, but here are some ideas on what can be done about it.</p>
<ul>
<li>The code setting the IODIRA register would go well in a subVI with an appropriate name. This VI should be made private to the class.</li>
<li>The array of bytes fed to the I2C <code>Write.vi</code> contains some magic numbers. You could replace the first byte with something more readable, such as a ring or enum.</li>
<li>If you decide to create a ring representing the register address, it should be made into a private type definition of the class.</li>
<li>Avoid adding more than the first one or two elements to the ring for now. We still do not know which registers we are going to address and by only adding the ones we need there is a minimal amount of code we need to change later if we change our minds.</li>
<li>Also adding registers we are not yet using can make the code confusing. It turns out that IODIRA and IODIRB works analogously, but if we were uncertain we could add only IODIRA for now.</li>
<li>Once you have replaced the first <code>0x00</code> with something readable, you should be able to identify a chunk of code making a nice subVI. </li>
</ul>
<p>The last VI would actually encapsulate a core concept, which we will leverage moving forward.
A suitable name for the VI would be <code>Write Registers.vi</code>, and this should also be private to the class.
It would look something like below.</p>
<p><img alt="Write Registers.vi" src="img/Refactoring1.png"/></p>
<p>You should do the refactoring in small steps and always run all tests touching the refactored code between each change.
In this way you can be sure you are not changing the behavior.</p>
<p>If the above was unclear, you can always check out the <code>solution</code> branch and revert to the commit called "Refactoring after first Test".</p>
<h2 id="addressing-the-addressing-issue">Addressing the Addressing Issue</h2>
<p>Now we have managed to write the IODIRA register, but we took some shortcuts.
One thing we did was hardcode the I2C address of the MCP23017, let us resolve this.</p>
<p>The address of the device can be configured by pulling the address programming pins of the device either high or low.
There are three bits, allowing for 8 different addresses.
Refer to the datasheet for details, but for now it is enough to consider the figure below.</p>
<p><img alt="I2C addressing" src="img/I2C-addressing.png"/></p>
<p>Looking at this we see that our code written earlier is actually wrong.
When the registers are all pulled low, we do not get an I2C address of 0: we get the address 0 masked with the binary number <code>0b00100000</code>.
Let's fix that by updating our first test.</p>
<p><img alt="Addressing Test 1" src="img/Test1-1-addressing.png"/></p>
<p>We added an input to the constructor, which feels like an appropriate place to define the address used.
We then changed the 0, which we added earlier as a placeholder, to <code>0b00100000</code>.
Now the test fails again and we should make it pass.
This should again be trivial - update the value of the constant from earlier.</p>
<p>Now, we still have the address hard coded (unless you did more than you needed to earlier).
To resolve this, we need to add another test showing what should happen for <em>e.g.</em> address 2.
After this you will now have two test VI:s in your test case class.
A pro-tip here is to save a copy of the previous test to save some time, as this will just be a slight variation of it.</p>
<p><img alt="Test 2" src="img/Test1-2.png"/></p>
<p>Now we have a failing test and we need to actually use the value of the address provided to the constructor in order to make both our tests pass.
Remember, you are not allowed at any point to make an earlier test fail.
The implementation should be straight forward.
If you need help, look at the "Test 2 Passing" commit of the solution branch.
Not much refactoring to do, so let us move on to the next test.</p>
<h2 id="controlling-the-outputs">Controlling the Outputs</h2>
<p>Now when we have the port configured as an output, we can start updating it by simply writing to the GPIOA register at <code>0x12</code>.
Reading the datasheet we discover that this is done similar to earlier, by first setting the register pointer and then setting the value.</p>
<p>As a requirement, we will assume that we want to be able to set the bits individually and not write the whole port at once.
This will impact what our API looks like and will require us to handle the state of the port somehow, but we will consider that later. 
Baby steps.</p>
<p>A good first test would be to set GPIOA0, which is the first bit on the A port, to 1.
We will now need to add a second public VI to our class and the API could look like below.
Feel free to use the type defined enum provided with the project to represent the GPIO channels.</p>
<p><img alt="api" src="img/api.png"/></p>
<p>Our next test would look like below.</p>
<p><img alt="Test3" src="img/Test1-3.png"/></p>
<p>Making this test pass is again easy. 
Remember, it is okay to just use constants on the block diagram as long as all tests still pass.
Depending on how you solved it, there might be opportunity for refactoring.</p>
<p>Keep in mind that we already created a VI for setting a register and a type for the register address.
The type can be extended and the VI can be reused, and the result is that we have no duplication of logic.
If we would <em>not</em> have discovered the refactoring opportunity after the first test, we would likely sense it now as the logic is the same for setting the registers.</p>
<h2 id="adding-more-tests">Adding more Tests</h2>
<p>We are able to set the first bit on the A port, but that is not good enough.
Let us add another test to set another bit.
The choice of which bit is arbitrary, but it is usually good to check edge cases. </p>
<p><img alt="test4" src="img/Test1-4.png"/></p>
<p>To make this pass we need to do some bit shifting, but I'm sure you will figure this one out.</p>
<p>The next thing to could be to write to the B port.
In this case we will get a test like below.</p>
<p><img alt="test5" src="img/Test1-5.png"/></p>
<p>There is actually two different things making this test fail.
The register needs to be <code>0x13</code> and there will be an overflow on the byte data type setting the register.
We will need to add some kind of modulo operation to resolve this.</p>
<p>When you have the test passing, the block diagram is getting a bit crowded and it is good time to do some refactoring.
You could identify the "Channel to Bitmask.vi" and "Channel to Register.vi" in the "Set GPIO State.vi",as shown below.</p>
<p><img alt="test5 refactor" src="img/post-test5-refactor.png"/></p>
<h2 id="setting-multiple-bits">Setting Multiple Bits</h2>
<p>So far, so good. 
But we still have a problem.
If we were to set two bits in the same port, the second operation would undo the first.
This is shown by the test below.</p>
<p><img alt="test6" src="img/Test1-6.png"/></p>
<p>The reason it fails is  because the second write will be setting <code>0b10</code>, as it is not aware that the 0th bit should also be high.
In order to make this one pass, we will need to track the state.
The "Channel to Bitmask.vi" comes in handy.</p>
<p>Once you have got that one passing, there is not much left.
Except, we cannot set a bit low.
That is a bit silly, and the test below fails.</p>
<p><img alt="test7" src="img/Test1-7.png"/></p>
<p>In order to make this pass, we will need to actually look at the value of the boolean <code>State</code> input to the "Set GPIO State.vi".
Once we have the test passing we can again start to consider the structure of the code and improve the readability.
By separating the calculation of the state from the call to the I2C bus, the operation handled by the "Set GPIO State.vi" may be split into two parts as below.</p>
<p><img alt="test7 refactor" src="img/Test1-7-refactor.png"/></p>
<p>This quite readable.
And now, we only have one problem left.
We only have one state so far, but we have two ports.
So updating one port will mirror to the other, as is shown by this failing test.</p>
<p><img alt="Test 8" src="img/Test1-8.png"/></p>
<p>If it is not clear what failed, have a look at the failure description. 
<code>Address: 34(U8) == 34(U8), Data: [19, 2](U8) != [19, 3](U8), error in (no error): No Error(Cluster) == No Error(Cluster)</code>
The value written to the B port should have been 2 (binary <code>0b10</code>), but we got the first bit mirrored from port A.
To resolve this, you will need to make the states specific to each port.
At this point I actually decided to inline the "Channel to Register.vi", and this is normal during refactoring.
Something which made sense 10 minutes ago might not have been such a good idea after all.</p>
<h2 id="final-thoughts">Final thoughts</h2>
<p>At this point we have fully implemented the functionality needed to use the MCP23017 as a digital output device.
If you have the hardware setup, chances are high that you will be able to toggle a LED.
You probably did not have to do a lot of debugging, as the steps we took were so small that there should not have been much to debug.</p>
<p>Keeping all the previous tests passing, we could focus on adding a tiny bit of functionality, while still keeping everything working.
This allowed us to make steady progress and allowed us to focus on one piece at at time.
The design that emerged is quite clean and the code is very readable, due to our constant refactoring efforts.
When you get experienced, you are able to control the step size and adjust as you go.</p>
<p>As we did test every little bit of code we added, the test coverage is 100%.
Because we have seen every test fail, we can be very confident that the tests actually works and tests something useful.</p>
<p>This same technique works on all different levels of a software system, as well designed software is fractal in nature.
Different levels of abstraction should be separated by abstractions, through interfaces, which serves as our architectural boundaries.
These boundaries are natural seems where we can inject test doubles, but also augment the behavior of our system - without changing it.</p>
<p>One thing to note is that if you wanted to use the B port as output, that too would need to be configured on creation the same way we did in our first test.
I plan to continue this exercise to show how we can implement port B as an input, if there is any interest for such an exercise.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Prerequisites" class="md-footer__link md-footer__link--prev" href="../15_Prerequisites/Prerequisites/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              Prerequisites
            </div>
</div>
</a>
<a aria-label="Next: License" class="md-footer__link md-footer__link--next" href="../90_License/LICENSE/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              License
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            Copyright © 2024 Astemes
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
            Material for MkDocs
          </a>
 ... <a class="link--pdf-download" download href="..\Astemes Mocking Exercise.pdf" title="PDF">download PDF</a></div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.indexes"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
<script src="../assets/javascripts/bundle.1e84347e.min.js"></script>
</body>
</html>